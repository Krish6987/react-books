pipeline {
    agent any
    tools {nodejs "Books"}
    stages {
     /*stage('Install Node Modules') {
            steps {
                sh 'npm install'
            }
        }*/
         /*stage('Build') {
            steps {
                sh 'npm run build'
               
            }
        }*/
        /*stage('Test'){
            steps{
                sh 'npm run test'
            }
        }
         stage('Sonar Analysis'){
            steps{
                 withSonarQubeEnv('SonarQube'){
                    sh 'sonar:sonar'
                }
            }
        }
        stage('Quality Gate'){
            steps{
                timeout(time: 1, unit: 'HOURS'){
                    waitForQualityGate abortPipeline:false
                }
            }
        }
        stage('Artifact Upload'){
            steps{
               sh 'cd /var/lib/jenkins/workspace/React_Pipeline/'
               sh 'zip -r $BUILD_NUMBER.zip build/'
               withCredentials([usernamePassword(credentialsId:'Nexus_Credentials',usernameVariable:'username',passwordVariable:'password')]){
               sh 'curl -v -u $username:$password --upload-file $BUILD_NUMBER.zip http://18.224.155.110:8081/nexus/content/repositories/devopstraining/hexagon6/'
                }
            }
        }*/
     
        stage('Deploy to Ansible'){
            steps{
                sh 'sudo scp -i .ssh/id_rsa.pub /var/lib/jenkins/workspace/React_Pipeline/build.zip ansadmin@172.31.20.16:/home/ansadmin'
                sh 'rm -r build.zip'
            }
        }
        ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDVDQ2fzjeAb/W9dqsA5DPUgPnPvckCiTmI4uZULv92S3zkfxYZilZJZdRyDLWG68EN7ejfN9Ba4QQzTCT0tYgte42Ub4JdFUwTebcwJoMB0kup9yLnuCDMPrD+5Ich0LY1SE+nSYOTybokzw45OyooBNKmeDA8b85Y0O9fRnBOqA8MSdWfOop9WjUcCwegh5XJbge4Jmla7zQuyQ4kcO3ywfGSviChUD7wPHGvYPp1uJ1O9NKaazc4ULJzdSeazlfvstirD+Hf2iCqbngRO0oK/dLZ1j0hZM/oiliLKF0x3JNg72Yf7+2lKg2IJRrGJaeOwdbufHET1G/SBR3fhqAN jenkins@ip-172-31-39-37.us-east-2.compute.internal

      
      /*stage('Serve') {
            steps {
                sh 'pm2 start npm -- run build-serve --watch'
            }
        }*/
    }
}
